<html>
<head>
  <% include ./header.ejs %>
</head>
<body>
  <% include ./nav.ejs %>
  <div class="container">
    <h4>유지보고확인서편집</h4>
    <div class="row">
    <div class="col s12 l6">
      <form action="/maintain_report/<%=data.id%>?_method=PUT"  method="post" >

        <div class="row">
          <div class="input-field col s12 ">
            <label>발송자</label>
            <input type="text"  placeholder="발송자"  value="<%=data.sender%>" required disabled>
          </div>
          <div class="input-field col s12 ">
            <label>메일제목</label>
            <input type="text"  placeholder="메일제목" value="<%=data.subject%>" required disabled>
          </div>
        </div>

        <div class="row">
          <div class="input-field col s6 l2">
            <label>년</label>
            <input type="text" name="year" placeholder="년"  value="<%=data.year%>" required>
          </div>
          <div class="input-field col s6 l2">
            <label>월</label>
            <input type="text" name="month" placeholder="월"  value="<%=data.month%>" required>
          </div>
          <div class="input-field col s12 l8">
            <label>수신일</label>
            <input type="text" placeholder="수신일" value="<%=data.received_at%>" disabled>
          </div>
        </div>
        <div class="row">

          <div class="input-field col s12 ">
            <label>파일경로</label>
            <input type="text"  placeholder="파일경로" value="<%=data.filepath%>" disabled>
          </div>

        </div>
        <div class="row">
          <div class="input-field col s12 ">
            <label >매칭된 품의</label>
            <input type="text" disabled value='<%=maintain_report_company.invoice_type + " " +maintain_report_company.company_name +" "+ maintain_report_company.item_name%>'>
          </div>

        </div>
        <div class="row">
          <label><h4>품의변경</h4></label>
          <div class="input-field col s12 l6">
              <select id="input-2">
                <% for(var i =0 ;i<companies.length;i++) { %>
                    <option value="<%=i%>"><%=companies[i].company_name%></option>
                  <% } %>
                <option value="" disabled selected>Choose your option</option>
              </select>
              <label>회사선택</label>
              <input type="hidden" name="company_name" id="company_name" >
          </div>
          <div class="input-field col s12 l6">
              <select id="input-3">
                <option value="" disabled selected>Choose your option</option>
              </select>
              <label>품의선택</label>
              <input type="hidden" name="item_name" id="item_name" >
          </div>
        </div>

        <div class="row">
          <input id="submit" class="right btn" type="submit"  value="등록">
        </div>
      </form>
    </div>
    <div class="col s12 l6">
      <embed src="/maintain_reports/<%=data.filepath.split('\\').pop()%>" type="application/pdf" width="100%" height="600px" view="Fit" />
    </div>
  </div>
  </div>

  <% include ./footer.ejs %>
  <script>
    $(document).ready(function(){
      $('select').formSelect();
      $('#submit').prop('disabled', true)
      $("#input-2").change( function() {
        console.log("test")
        var str2 = ""
        $('#company_name').val($("#input-2 option:selected").text());
          console.log($('#company_name').val())
        $("#input-2 option:selected").each(function(){
          str2 += $(this).text();
        });
        $.ajax({
          type:'GET',
          url: "/apis/company_names?invoice_type=maintenance&company_name="+str2,
          data: null,
          success: function(data){
            $('#submit').prop('disabled', true)
            $("#input-3").empty();
            $("#input-3").append("<option value='' disabled selected>Choose your option</option>")
            $.each(data, function(idx,item){

              $("#input-3").append($('<option>', { value: idx, text: item["item_name"]}));
            })

            $("#input-3").formSelect();
          }
        })

      })
      $("#input-3").change( function() {
          $('#item_name').val($("#input-3 option:selected").text());
          $('#submit').prop('disabled', false)
      })
    });
  </script>
</body>
</html>
